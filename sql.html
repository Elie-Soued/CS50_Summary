<!DOCTYPE html>

<html lang="en">
  <head>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="navbar.js" type="module"></script>
    <script src="utils.js" type="module"></script>
    <link href="styles.css" rel="stylesheet" />
    <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />
  <link href="/images/logo.png" rel="icon" type="image/png" />
    <title>SQL</title>
  </head>
  <body class="d-flex flex-column align-items-center">
    <header class="d-flex flex-column justify-content-center  h-auto">
      <nav-bar-50></nav-bar-50>
      <img   src="/images/sqlthumbnail.jpg"  class="image_top"/>
      <p><i>Image from CS50, licensed under CC BY-NC-SA 4.0.</i></p>
    </header>
    <main class="image_top">
      <section class="image_top">
        <h3>What is SQL?</h3>
  

      <p>
        SQL or structured query language is a declarative language used for
        relational databases.<br />
        It is important to note that everything that is done in SQL could be
        done in other languages.<br />
        SQL has been designed to manipulate data more easily.<br />
        One SQL line can replace many lines of python.<br />
        Here also, we will not spend time on the syntax but rather on some
        interesting concepts that we covered in the course.<br />


        <h5>CRUD</h5>
        The main actions that we make on a database are :<br />
        C: Create / INSERT <br />
        R: Read / SELECT<br />
        U: Update / ALTER<br />
        D: Delete / DROP
      </p>
      <p>
        
        <h5>Primary key, foreign key and join tables</h5>

        <p>
          A Primary Key is a unique identifier for a row in a table. It ensures that each record in the table can be uniquely identified. <br>
          A Foreign Key is a field in one table that refers to the <strong>Primary Key</strong> of another table. It establishes a relationship between the two tables. <br>
          Let's consider two tables: <strong>Company</strong> and <strong>Employee</strong>.
      </p>
       

      

      <p> Here the <code>Company ID</code> serves as the <strong>Primary Key</strong>, ensuring each company has a unique identifier.</p>
      
      <table table class="table table-striped" style="border-collapse: collapse; width: 100%; font-size: 14px; width: auto;">
          <tr>
              <th>Company ID (PK)</th>
              <th>Company Name</th>
              <th>Product</th>
              <th>Location</th>
          </tr>
          <tr>
              <td>1</td>
              <td>Tech Corp</td>
              <td>Software</td>
              <td>USA</td>
          </tr>
          <tr>
              <td>2</td>
              <td>InnovateX</td>
              <td>AI Tools</td>
              <td>Germany</td>
          </tr>
      </table>
      <br>
 
      <p>And here the <code>Company ID</code> is a <strong>Foreign Key</strong>, linking each employee to a company from the <strong>Company Table</strong>.</p>
      
      <table table class="table table-striped" style="border-collapse: collapse; width: 100%; font-size: 14px; width: auto;">
          <tr>
              <th>Employee Name</th>
              <th>Employee Position</th>
              <th>Company ID (FK)</th>
          </tr>
          <tr>
              <td>Alice</td>
              <td>Developer</td>
              <td>1</td>
          </tr>
          <tr>
              <td>Bob</td>
              <td>Manager</td>
              <td>2</td>
          </tr>
      </table>
      <br>
      




      <p>In a <strong>many-to-many relationship</strong>, a single record in one table can be associated with multiple records in another table, and vice versa. 
      Since relational databases do not support direct many-to-many relationships, we use a <strong>join table</strong> (also called a <strong>junction table</strong>) to bridge the two tables. Consider the following tables:</p>
      <ul>
          <li><strong>Student</strong>: Stores information about students (e.g., name, major, and ID as the primary key).</li>
          <li><strong>Courses</strong>: Stores information about courses (e.g., subject, duration, and ID as the primary key).</li>
      </ul>
      <p>To track which students are enrolled in which courses, we create a <strong>join table</strong> that contains foreign keys referencing both tables.</p>
      
      <pre style=" margin: 0; padding: 0;" >
      <code>
      CREATE TABLE student_course (
          student_id INT,
          course_id INT,
          PRIMARY KEY (student_id, course_id),
          FOREIGN KEY (student_id) REFERENCES Student(id) ON DELETE CASCADE,
          FOREIGN KEY (course_id) REFERENCES Courses(id) ON DELETE CASCADE
      );
      </code>
      </pre>
      

      <p>To retrieve the names of students who have taken a specific course (e.g., <em>Computer Science</em>), use the following query:</p>
      <pre style=" margin: 0; padding: 0;">
      <code>
      SELECT Student.name 
      FROM Student 
      JOIN student_course ON Student.id = student_course.student_id 
      JOIN Courses ON Courses.id = student_course.course_id 
      WHERE Courses.subject = 'Computer Science';
      </code>
      </pre>
    
      <p><strong>Table Summary</strong></p>

      <table class="table table-striped" style="border-collapse: collapse; width: 100%; font-size: 14px; width: auto;">
        <thead>
          <tr>
            <th>Relationship</th>
            <th>Example</th>
            <th>Schema</th>
            <th>Foreign key placement</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>One to One (1:1)</td>
            <td>Person → Passport</td>
            <td>passports.person_id UNIQUE </td>
            <td>Foreign key in one table, set as unique.</td>
          </tr>
          <tr>
            <td>One-to-Many (1:M)</td>
            <td>Company → Employees</td>
            <td>employees.company_id </td>
            <td>Foreign key in the child table (employees).</td>
          </tr>
          <tr>
            <td>Many-to-Many (M:M)</td>
            <td>Students ↔ Courses</td>
            <td>enrollments(student_id, course_id)</td>
            <td>Join table with two foreign keys. </td>
          </tr>
        </tbody>
      </table>



      <p>
        <br>
<h5>Indexes, Race conditions and SQL injections attacks</h5> 

<br>
<b>Indexes</b><br>
Indexes create a B-tree structure (not binary tree structure) that allows us to access information faster.<br>
They improve performance a lot when we want to read data from the database but might slow down the insertion and deletion ( as we saw with tree like structure that need to stay balanced). So they are great for read heavy sites.<br>
<br>
<b>Race conditions</b>
<br>
Imagine a picture goes viral and everyone in the world wants to like it at the same time.<br>
How can we make sure we can hanlde the database update in a way that data is not lost?<br>
So there are many techniques to handle this problem but we will focus on one in particular which is transcations and pessimistic locking.<br>
In our example, the transaction will group the reading and the updating of the likes in one operation and the locking will make sure that one transaction is executed at a time.<br>
For more on the topic look ACID properties in database<br>
<br>
<b>SQL Injection Attacks</b><br>
SQL Injection Attacks are malicious inputs that could give access to unauthorized information.<br>
If your API is using f format and not placeholders, a user could enter as username : name'-- <br>
The ' would close the first string and the -- would ignore everything after this command.<br>
So basically I user could access the account of someone by only entering the username and not the password.<br>
So use the placeholder instead of the f string.<br>
rows = db.execute (f"SELECT * FROM users WHERE username = '{username}' AND password = '{password}'") // Bad<br>
rows = db.execute ("SELECT * FROM users WHERE username = ? AND password = ? ", username , password)  // Better<br>
      </p>
        <img src="/images/SQL-Databases.png" class="small_image" />
    </section>
    </main>

    <footer>
      <p>
        Python and SQL are languages that are also used a lot in Web programming.<br>
        In the 90s the world wide web as we know it was created.<br>
        Do you know how the <a href="/htmlcssjs.html">world wide web</a> works?
        
              </p>
        
    </footer>
  </body>
</html>
